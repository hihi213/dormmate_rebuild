# DormMate 기능 인벤토리
*용도: DormMate 서비스의 기능·정책·용어를 모듈별로 정리한 기준 문서로, 확장 요구나 애매한 정책을 검토할 때 참고한다.

## 1. 계정 및 권한

### 운영 환경 요약
- **층 구성**: 기숙사는 2층(남성)과 3~5층(여성)으로 운영되며 층별 24개 호실(예: 201~224, 301~324)을 보유한다.
- **호실 유형**: 기본은 3인실(`TRIPLE`, 정원 3명, `personal_no` 1~3)이며, 각 층 지정 호실은 1인실(`SINGLE`, 정원 1명, `personal_no` 1)로 운영한다. 1인실 위치는 2F 213·224, 3F 313, 4F 413, 5F 513.
- **식별 규칙**: 거주자는 `room_number-personal_no` 조합(예: `201-1`)으로 식별하며, 거주 기간은 최대 1년이고 중도 퇴사가 가능하다.
- **소통 채널**: 공식 공지와 방침은 Band 앱을 통해 게시되며, DormMate 알림은 개인별 후속 안내에 집중한다(알림 피로도 최소화를 전제로 설계).

### 개요
- DormMate는 거주자, 층별장, 관리자 3개 역할을 지원한다.
- 계정 관리는 Band 톡 등 외부 시스템과 연계할 여지를 남겨두되, 기본 인증/세션은 서비스 내부에서 처리한다.

### 핵심 정책
- **회원가입**: 호실 번호 + 개인 번호 조합으로 가입한다. 1인실은 개인 번호 1 고정이며, 관리자 승인을 받을 때까지 대기 상태를 유지한다.
- **로그인/세션**: 아이디는 대소문자 구분 없이 처리하고 세션은 7일 유지한다. 비밀번호 변경 시 기존 세션은 모두 무효화한다. *(MVP 데모 한정)* 데모 이후 계정 관리 고도화 일정에 맞춰 아이디 대소문자 구분을 재도입한다.
- **탈퇴**: 계정은 비활성화 처리하고 물품 이력은 보존한다. 탈퇴 직후 로그인은 불가해야 하며, 다른 모듈에서 이력 조회는 가능해야 한다.
- **접근 제어**:  
  - 거주자: 배정된 칸 및 본인 물품만 접근 가능  
  - 층별장: 거주자 중에서 선발되며, 담당 층 전체 칸에 대한 검사·보고와 조회 권한을 갖지만 타인의 포장을 직접 수정하지 않는다.  
  - 관리자: 전역 접근, 역할 변경 권한 보유
- **알림 설정**: 사용자별로 임박, 검사 결과 등 알림 종류와 백그라운드 수신 여부를 토글할 수 있다. 실패 로그만 저장하며 재시도는 수동으로 진행한다.


## 2. 냉장고 – 일반 기숙사생

### 용어
- **포장(FridgeBundle)**: 냉장고 스티커 1개에 대응하는 단위. 여러 물품을 포함한다.
- **물품(FridgeItem)**: 포장 내부의 개별 품목.
- **스티커 번호**: 거주자가 스티커에 기입하는 3자리 숫자. UI는 칸 순번(`slot_index`)을 문자(A/B/C…)로 변환해 `A123` 형태로 보여 주지만, 서버에는 칸 ID와 3자리 숫자만 저장한다.
- **칸 할당**: 기본 구성은 냉장 3칸·냉동 1칸이며, 접근 권한을 위해 냉장 칸마다 8호실씩(24 ÷ 3)을, 냉동 칸에는 24호실 전체를 공용으로 매핑한다. **포장 허용량은 라벨 범위(기본 001~999) 또는 관리자 설정 `max_bundle_count`로 결정**되며, 호실 수와는 별도로 조정할 수 있다.

### 기능 정의
- **칸 선택**: 사용자에게 배정된 냉장/냉동 칸만 선택 가능하다. 가용 포장 수를 초과하면 등록을 제한한다.
- **포장 등록**: 장바구니 형태로 물품 이름/수량/유통기한/메모를 입력한다. 저장 시 칸 허용량(`max_bundle_count`)을 검사하고 해당 칸의 라벨 시퀀스에서 3자리 번호를 자동 발급한다. 기본 허용량은 라벨 범위(001~999)이며, 데모 시나리오에서는 설명을 위해 특정 칸만 3개로 제한한다. 포장 메모는 작성자만 열람한다.
- **포장/물품 관리**:  
  - 포장: 포장명·메모 수정 가능, 스티커 번호/등록일시는 수정 불가  
  - 물품: 이름·유통기한·수량 수정, 소프트 삭제 후 라벨 재사용 가능  
  - 포장 전체 삭제 가능
- **조회/검색**: 최신순 목록 제공, D-3 이하 임박은 노란 배지, 만료는 빨간 배지로 표시한다. 품목/포장명 검색과 “칸 선택 + 3자리 번호 입력” 방식의 스티커 검색을 지원한다.
- **미등록 물품 처리**: 검사자가 발견한 미등록 물품은 간단 등록 후 즉시 폐기한다. 통계에는 “미등록 폐기”로만 집계하며 추가 알림은 발송하지 않는다.
- **접근 제한**: 타인 포장 수정·삭제 시 403을 반환하고, 검사 중인 칸/포장은 잠금 상태로 표시해 수정할 수 없다.
- **검사 이후 처리**: 검사 후 수정된 물품은 별도 필터로 확인할 수 있다.

### 냉장고 증설·재배분
- 기본 구성은 층당 냉장고 1대(냉장 3칸 + 냉동 1칸)이며, 각 칸은 24개 호실을 균등 분배한다.
  - 냉장 1~3번 칸: 01~08호, 09~16호, 17~24호를 매핑.
  - 냉동 칸: 층 내 24개 호실 전체를 공용으로 사용.
- 냉장고가 증설되면 `compartment_room_access`를 재계산해 호실 분배를 자동 조정한다.
  - 예: 냉장칸이 6개가 되면 호실은 4개 단위로 재배분하고, 신규 냉장고 슬롯은 5~8번으로 이어 붙인다.
- 칸 증설/재배분 정책은 관리자 도구에서 확인할 수 있으며, 재배분 후에도 기존 라벨 시퀀스는 유지한다.

---

## 3. 냉장고 – 알림 & 일정

### 목적
- 층별장 검사를 비롯해 물품 임박/만료 정보를 거주자에게 전달하고, 냉장고 일정 정보를 공유한다.

### 주요 정책
- **검사 결과 알림**: 층별장이 검사 제출 시 경고/폐기 대상 거주자에게 즉시 발송한다. 동일 세션/사용자 조합은 중복 발송하지 않는다.
- **임박/만료 알림**: 매일 09:00 배치로 생성하며 하루 1회만 전달한다. 임박은 3일 이내, 만료는 이미 지난 물품을 요약한다.
- **알림 UX**: 알림 목록은 미읽음을 상단에, 읽음을 하단에 배치한다. 냉장고 메인 진입 시 관련 알림은 자동으로 읽음 처리되며, 24시간 후 만료·자동 제거된다. 알림 설정에서 종류별 ON/OFF와 백그라운드 허용 옵션을 제공한다.
- **상세 연계**: 알림에는 `correlationId`, `actionIds`, `penaltyHistoryIds` 등 이벤트 식별자를 포함해 검사 세션·조치·벌점과 고유하게 연결한다. 프런트는 이 값을 이용해 상세 화면으로 이동하되, 접근 권한은 로그인 사용자와 역할 검증을 그대로 따른다.
- **공지 분리**: 주요 공지는 Band 앱으로 게시되므로 DormMate 알림은 개인 맞춤(검사 결과, 임박 위신문) 위주로 제한해 중복 발송과 피로도를 줄인다. 사용자는 백그라운드 수신을 개별 제어할 수 있다.
- **검사 일정**: 층별장이 자신의 책임 구역 칸을 대상으로 일정 생성/수정/완료 처리를 수행하며, 일정 데이터는 서버(`inspection_schedule`)에서 관리된다.


---

## 4. 냉장고 – 층별장(검사자)


### 역할
- 층별장은 담당 층의 냉장고 검사를 수행하고, 검사 결과를 기록·전파한다.  
- 층별장은 타인의 포장을 직접 수정하지 않으며, 검사·보고와 관련된 조치만 수행한다.
- **확장**: 다중 검사자 합류(최대 2인)와 실시간 동기화는 차기 단계에서 도입한다.

### 기능 정의
- **검사 세션**: 담당 층 칸만 검사 시작 가능하며, 세션 생성 시 해당 칸을 잠금 상태로 전환한다. 활동(조치 기록, 메모 입력 등)이 발생할 때마다 `lockedUntil`을 현재 시각 기준 30분 뒤로 갱신하고, 추가 활동이 없으면 30분 후 자동으로 잠금이 해제된다. 필요 시 관리자가 강제 종료로 즉시 잠금을 해제할 수 있다. 클라이언트는 30~60초 간격 폴링으로 최신 상태를 재조회하고, Draft는 `localStorage`에 보관돼 새로고침 후에도 복원 가능하며 세션 종료 시 자동 정리된다. *(MVP: 단독 검사 기준)*  
- **현장 제약**: 층별장이 칸을 비우면 라벨이 순서 없이 뒤섞이므로, 검사 화면은 정렬을 강제하기보다 라벨 검색과 상태 필터링을 빠르게 수행할 수 있어야 한다.
- **확장**: 동일 칸 검사 중일 경우 “검사 합류”로 참여(최대 2인)하고 SSE 기반으로 조치 결과를 공유한다. 네트워크 문제 시 단독 검사 플로우로 전환하는 폴백 전략을 마련한다.
- **검사 화면**: “검사 전” / “검사 완료” 탭 구조를 유지하고, 만료/검사 후 수정 두 가지 토글 버튼과 포장/물품 검색을 제공한다(검색과 필터는 교차 적용 가능).
- **임시 저장**: 검사자는 현재 기기에서 자동 저장(로컬 스토리지)으로 복원되며, 필요 시 수동 저장 버튼도 동일한 로컬 Draft에 기록한다. 다중 검사자 동시 편집을 지원해야 할 때 서버 Draft API로 이 구조를 이관하며, 그 전까지는 서버 저장을 시도하지 않는다.
- **조치 유형**:  
  - 경고: `WARN_INFO_MISMATCH`(정보와 실제 보관 불일치), `WARN_STORAGE_POOR`(포장 상태 불량)  
  - 폐기: `DISPOSE_EXPIRED`(유통기한 경과 폐기)  
  - 통과: `PASS`  
  - 미등록 물품 즉시 등록 + 폐기: `UNREGISTERED_DISPOSE` (미등록 품목명 필수 기록)  
  - 기타: `reason_code`를 비워두고 자유 메모(`free_note`)에 세부 사유를 남긴다.  
- **검사 제출**: “검사 전” 탭이 비어야 제출 가능하다. 제출 시 검사자·일시·칸·조치 내역을 저장하고, 경고/폐기/총 포장 등 통계를 집계한 뒤 관련 거주자에게 알림을 발송한다. 세션 종료 후 칸 잠금을 해제한다.
- **검사 이력**: 층/검사자/기간 필터를 제공하고, 상세 페이지에서 조치 내역을 확인할 수 있다.
- **역할 전환**: 층별장 임명/해제는 기존 거주자 계정을 승격/복귀시키는 방식으로 처리하며, 임명 시 즉시 추가 권한이 부여되고 해제 시 일반 거주자 권한만 남는다. 진행 중 검사 세션이 있다면 안전하게 종료하거나 다른 층별장에게 승계한다.

### 실시간 협업 및 복구
- **동시 검사**: 동일 칸 검사가 진행 중이면 두 번째 층별장은 “검사 합류”로 참여해 하나의 `inspection_session`을 공유한다. SSE로 조치 이벤트가 즉시 동기화되어 각 검사자 화면의 “검사 전/검사 완료” 탭이 동일하게 갱신되고, 조치자 정보가 표시된다.
- **세션 제약**: 한 칸에는 동시에 하나의 검사 세션만 존재하며 최대 2명의 검사자만 합류할 수 있다. 합류한 검사자 간에는 포장별 조치 락이 적용돼 중복 조치를 방지한다.
- **네트워크 장애**: SSE 연결이 끊기면 EventSource 자동 재연결을 사용하고, 재연결 시 서버가 최신 세션 상태를 재전송해 누락된 조치 내역을 보정한다. 재연결 실패가 지속되면 검사자는 단독 모드로 전환해 세션을 마무리하고 결과를 제출한다.

---

## 5. 냉장고 – 관리자


### 역할
- 전체 냉장고 운영 상황을 모니터링하고, 층별장 임명/해제, 물품 관리, 자원 재배치 등을 담당한다.
- 운영 프로세스에서는 **층별장이 현장 업무(검사 일정 등록·검사 실행 등)를 수행**하고, 관리자는 정책·현황 관리와 지원 역할에 집중한다. 관리자 계정에도 일정/검사 API 권한은 존재하지만, 실제 현장 흐름은 층별장 주도로 진행한다.

### 기능 정의
- **현황 대시보드**: 등록 물품(층/칸별), 임박 물품, 주간 검사 횟수/조치, 활성 사용자 수, 알림 발송 현황 등을 제공한다.
- **역할 관리**: 층별장 임명/해제를 즉시 반영하고, 해제 시 진행 중인 검사를 안전하게 종료한다.
- **물품 관리**: 전체 물품 조회(층/칸/호실/상태/검색/페이지네이션), 강제 수정·삭제(사유 입력 후 알림), 일괄 처리 기능을 제공한다.
  - 검색 키워드는 포장명·라벨뿐 아니라 다자릿 슬롯 코드(예: `AA-101`), 보관자 이름, `floor + room` 조합(`3F 301`)을 지원한다. 삭제 이력은 `slotId` 필터와 라벨 재사용 히스토리 배지로 즉시 확인할 수 있어야 한다.
- **검사 이력**: 층, 검사자, 기간 기반 필터 및 상세 조회를 지원하며, CSV 내보내기 옵션을 고려한다.
- **권한 불일치 감시**: `R__fridge_views.sql`에 정의된 `vw_fridge_bundle_owner_mismatch` 뷰를 기반으로 `GET /admin/fridge/issues` API를 제공하고, 관리자 감사 로그 페이지에서 번들-호실-칸 매핑 오류(`issueType` = `NO_ACTIVE_ROOM_ASSIGNMENT`, `ROOM_NOT_ALLOWED_FOR_COMPARTMENT`)를 실시간 표로 노출한다. 항목 클릭 시 해당 번들 상세/재배분 화면으로 이동해 즉시 조치할 수 있어야 한다.
- **사용자 관리**: 사용자 목록(호실/이름/이메일/역할) 확인, 역할 변경, 계정 비활성화(퇴사자 등) 수행.
- **자원·알림 설정**:  
  - 알림 배치 시각 설정과 테스트 발송  
  - `notification_policy` 기반 정책 관리(TTL, 일일 발송 상한, 백그라운드 기본값)  
  - 냉장고 관제실(유닛/칸 상태 전환 `ACTIVE/SUSPENDED/REPORTED/RETIRED`, 라벨 범위/호실 재배분, 냉장고 추가/삭제)
- **시스템 모니터링**: CPU/메모리/디스크, API 응답 시간, 최근 100건 에러 로그를 확인할 수 있는 뷰를 제공한다.
- **벌점 제재 통보**: 벌점 기준치를 초과한 사용자에게 DormMate 알림으로 이용 제한 모듈을 통보한다.

---

## 6. 공통 시스템 정책

### 알림 피로도 관리
- 모듈별 하루 최대 발송 건수를 2건으로 제한한다.
- Band 공지와 중복되지 않도록 dedupe 키를 적용한다.
- 사용자에게 백그라운드 알림 허용 여부를 항상 제공한다.

### 상벌점 및 감사
- 자동 벌점: 도서관 연체(1일 1점)  
- 수동 벌점: 다목적실 노쇼(2점), 세탁실 방치(1점)  
- 누적 10점 이상 시 세탁실·다목적실·도서관 이용을 1주일간 제한하고 DormMate 알림으로 안내한다. 냉장고 기능은 유지한다.
- 모든 예약/대출/사용 기록에 감사 로그를 남겨 분쟁 시 증빙으로 활용한다.

### Band 연동
- 공식 공지(임명, 검사 결과 등)는 Band에 우선 게시하고, DormMate는 개인 맞춤 알림·내역 관리에 집중한다. 자동 동기화는 후순위로 둔다.

### 접근 제어 공통 원칙
- 역할별 권한을 명확히 분리하고, 모듈 확장 시 권한 매핑을 문서화한다.
- 인증/인가 로직 변경 시 OpenAPI 및 데이터 모델을 함께 갱신한다.

### 오류 응답 사전
- 모든 API는 `code` 필드와 HTTP Status를 포함한 `ProblemDetail` 형태로 응답하며, 프런트는 전역 오류 사전에서 도메인별 공통 메시지를 출력한다.
- 새로운 오류 코드를 추가할 때는 OpenAPI와 본 문서를 동시에 갱신해 UI·테스트와의 싱크를 유지한다.

---

## 7. 추가 확장 모듈 개요 (참고)

추가 확장에서는 세탁실, 도서관, 다목적실 등 추가 모듈을 도입해 DormMate의 공용 시설 관리 기능을 확장한다. 이 절은 정책 초안을 요약하며, 구체적인 구현 범위는 추후 별도 문서로 분리한다.

### 7.1 세탁실
- **핵심 시나리오**: 기기 예약·사용·종료 알림, 타인 기기 사용 중 행동(메시지, 남은 시간 수정), 미수거 처리, 고장 신고.
- **정책**: 종료 5분 전 알림, 남은 시간 정정(±10분), 미등록 사용자의 간편 등록, 관리자 고장 처리 및 사용 통계 관리.

### 7.2 도서관
- **핵심 시나리오**: 도서 검색/대출/반납/예약, 연장 요청, 연체 관리.
- **정책**: 반납 5일 전/당일 알림, 연체 시 매일 알림, 예약 가능/만료 알림, 예약 만료에도 벌점은 부과하지 않는다.
외부 도서 API는 국립중앙도서관, ISBN센터, 알라딘/교보 같은 서점·공공 데이터에서 제공하는 REST API를 말해요. 도서명이나 ISBN을 전달하면 저자, 출판사, 출판년도, 표지 이미지, 분류 코드 등의 메타데이터를 돌려주기 때문에 관리자 화면에서 새 책을 등록할 때 자동 완성용으로 쓰기 좋습니다. 예를 들어 국립중앙도서관 오픈 API는 https://www.nl.go.kr/NL/search/openApi/search.do에 isbn=9788965402602 같은 파라미터를 보내 메타정보를 받아오는 방식이에요.

### 7.3 다목적실
- **핵심 시나리오**: 10분 단위 슬롯 예약, 합석 옵션, 노쇼 신고 처리.
- **정책**: 예약 시작/종료 10분 전 알림, 노쇼 신고 시 관리자 확인 후 벌점, 강제 예약/취소 권한.

### 7.4 공통
- 하루 알림 제한, 상벌점/감사 로그 연동은 추가 확장 모듈에도 동일하게 적용한다.

---
## 8. 알림 체계 요약 (Must)
### 8.1 채널 및 동작
- **채널**: PWA 푸시(가능한 무음 방지), 메인 화면 상태 카드, 종 모양 알림 목록, 하단 탭 배지.
- **읽음 규칙**: 관련 화면/팝업 진입 시 자동 읽음 처리, 24시간 경과 시 자동 만료 가능. 미읽음 상태일 때만 배지/아이콘 활성화.
- **Band 연동**: 임명/공지 등 공식 안내는 Band에 우선 게시, DormMate는 개인 맞춤 알림·내역 관리에 집중.


### 8.2 모듈별 알림 정책

| 모듈 | 주요 알림 | 
|---|---|
| 세탁실 | 종료 5분 전, 상태 변경(관리/고장 신고), 남은 시간 정정, 메시지 도착 |
| 냉장고 | 유통기한 임박·만료(09:00 묶음), 검사 결과(경고/폐기/벌점), 검사 일정 변경 |
| 도서관 | 반납 5일 전/당일, 연체, 예약 대출 가능, 예약 만료 자동 취소(벌점 없음) |
| 다목적실 | 시작/종료 10분 전, 노쇼 신고 (미등록 신고는 Band 처리) |
| 시스템/관리 | 상·벌점 변동, 계정 승인 등 최소 공지 |

### 8.3 PWA 푸시 템플릿

| 제목 예시 | 본문 예시 |
|---|---|
| `[세탁실] {기기명} 종료 5분 전` | 곧 사용이 끝납니다. 수거를 준비해주세요. |
| `[세탁실] {기기명} 사용 종료` | 기기 사용이 종료됐습니다. 세탁물을 회수해주세요. |
| `[세탁실] {기기명} 메시지` | {보낸이}님의 요청을 확인해주세요. |
| `[세탁실] {기기명} 상태 변경` | 기기 상태가 {상태}로 전환되었습니다. 상세를 확인해주세요. |
| `[세탁실] {기기명} 종료 시간 조정` | 종료 예정 시간이 {종료시간}로 변경되었습니다. |
| `[다목적실] {방번호} 시작 10분 전` | {시작시각} 예약이 곧 시작됩니다. 준비해주세요. |
| `[다목적실] {방번호} 종료 10분 전` | 정리 후 퇴실을 준비해주세요. |
| `[다목적실] {방번호} 예약 취소` | 관리자에 의해 예약이 취소되었습니다. |
| `[다목적실] {방번호} 노쇼 신고` | 입력된 예약이 사용되지 않았다는 신고가 접수되었습니다. |
| `[도서관] 반납 5일 전` | {권수}권 반납 또는 연장을 진행해주세요. |
| `[도서관] 반납 당일` | {권수}권 반납이 오늘 마감됩니다. |
| `[도서관] 연체 발생` | 대출 도서가 연체되었습니다. 즉시 반납해주세요. |
| `[도서관] 예약 도서 이용 가능` | {권수}권을 5일 동안 대출할 수 있습니다. |
| `[도서관] 예약 기한 오늘까지` | {권수}권 예약 대출이 오늘까지 가능합니다. |
| `[도서관] 예약 자동 취소` | 대출 기한이 만료되어 예약이 자동 취소되었습니다. |
| `[냉장고] 점검 결과 알림` | 경고 {개수}건, 폐기 {개수}건이 발생했습니다. 확인해주세요. |
| `[냉장고] 유통기한 임박` | {개수}개 품목의 유통기한이 임박했습니다. |
| `[냉장고] 유통기한 경과` | {개수}개 품목의 유통기한이 지났습니다. 폐기해주세요. |
| `[시스템] 상·벌점 변동` | {사유}로 {변동점수}점이 반영되었습니다. 현재 {총점}점입니다. |

### 8.4 종 모양 알림 문구 예시
- `관리자로부터 상점 3점을 받았습니다.` / `'세탁물 방치' 사유로 벌점 1점을 받았습니다.`
- `최고 관리자가 회원님의 관리자 계정을 승인했습니다.`
- `'세탁기 1'의 작동이 5분 뒤 완료됩니다.`
- `다른 사용자가 '건조기 2'의 남은 시간을 수정했습니다.`
- `다른 사용자에게 '세탁기 1'번에서 '기다리고 있어요' 요청이 도착했습니다.`
- `사용 중인 '건조기 1'의 상태가 '고장 신고'로 변경되었습니다.`
- `'계란' 외 3개 물품의 유통기한이 5일 남았습니다.`
- `점검 결과, 회원님의 물품 1개가 '폐기' 처리되었습니다.`
- `'JPA 프로그래밍' 외 1권의 반납일이 5일 남았습니다.`
- `대출하신 '데이터베이스' 도서가 연체되었습니다.`
- `예약하신 '토비의 스프링' 도서 대출이 가능합니다.`
- `예약하신 '토비의 스프링' 도서가 대출 기한 만료로 자동 취소되었습니다.`
- `예약하신 '다목적실 A'의 사용 시작 10분 전입니다.`
- `사용 중인 '다목적실 A'의 종료 10분 전입니다.`
- `예약 도서의 대출 기한이 만료되어 자동 취소되었습니다.` (벌점 없음 안내)

### 8.5 탭 배지 규칙
- **값**: 미읽음 수(최대 9+), 점 표시 허용.
- **규칙**: 관련 화면 진입 시 소거, 24시간 경과 시 자동 만료 가능.
- **냉장고 탭**: 임박 묶음은 매일 09:00 1회 생성 후 확인 시 소거, 폐기 알림은 해결 전까지 유지.
- **도서관 탭**: 임박·당일·예약 가능 묶음은 09:00 생성 후 확인 시 소거, 연체는 해결 전까지 유지.
- **메인 화면**: 당일 예약된 다목적실(가장 빠른 시작 시간)과 사용 중 또는 알림 신청된 세탁실 기기 정보를 카드·팝업으로 제공.


### 8.6 중복 방지 키(dedupe)·TTL 규칙

| `kind_code` | `dedupe_key` 포맷 | 기본 `ttl_at` | 비고 |
|---|---|---|---|
| `FRIDGE_EXPIRY` | `FRIDGE_EXPIRY:{userId}:{yyyyMMdd}` | 생성 시각 + 24시간 | 매일 09:00 임박 배치. 다음날 배치가 같은 키를 사용해 중복 생성 방지. |
| `FRIDGE_EXPIRED` | `FRIDGE_EXPIRED:{userId}:{yyyyMMdd}` | 생성 시각 + 24시간 | 만료 묶음 배치. 해결 전까지 탭 배지는 유지하되, 알림 레코드는 하루 뒤 정리. |
| `FRIDGE_RESULT` | `FRIDGE_RESULT:{sessionUuid}:{userId}` | 생성 시각 + 7일 | 검사 제출 즉시 발송. 같은 세션+사용자는 중복 알림 금지. |
| `LAUNDRY_EVENT` | `LAUNDRY_EVENT:{machineId}:{eventUuid}` | 생성 시각 + 6시간 | 종료 임박/시간 정정/메시지 등 단기 이벤트. 이벤트 UUID는 도메인 서비스에서 생성. |
| `ROOM_PENALTY` | `ROOM_PENALTY:{userId}:{penaltyHistoryId}` | 생성 시각 + 30일 | 벌점/상점 기록 공지. 만료 전에도 사용자가 읽음 처리 가능. |
| 기타 | `{KIND}:{businessKey}` | 정책에 따라 설정 | 신규 kind 추가 시 동일 표에 항목을 추가하고 OpenAPI 예시를 갱신한다. |

### 8.7 알림 선호 기본값

| `kind_code` | 표시 이름 | 기본 Enabled | 백그라운드 허용 기본값 | 메모 |
|---|---|---|---|---|
| `FRIDGE_RESULT` | 냉장고 검사 결과 | ON | ON | 검사 조치·벌점 알림은 즉시 전달한다. |
| `FRIDGE_EXPIRY` | 냉장고 임박 알림 | ON | OFF | 3일 이내 임박 알림. 기본은 앱 사용 중에만 알림, 사용자가 백그라운드 허용을 선택 가능. |
| `FRIDGE_EXPIRED` | 냉장고 만료 알림 | ON | ON | 만료 물품은 긴급성을 고려해 기본적으로 백그라운드 알림 허용. |
| 기타 | 신규 kind 도입 시 정의 | ON | 서비스 정책에 따라 설정 | 신규 kind 추가 시 본 표와 OpenAPI를 함께 갱신한다. |
