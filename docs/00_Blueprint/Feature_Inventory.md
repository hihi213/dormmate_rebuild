# DormMate 기능 인벤토리 
**용도: 과거 DormMate 서비스의 기능·정책·용어를 모듈별로 정리한 기준 문서로, 확장 요구나 애매한 정책을 검토할 때 참고한다.**

---
## Phase 1. 물품 관리 (Inventory) — Current

### 기능
- 포장(FridgeBundle) 등록: 장바구니 형태로 물품 이름/수량/유통기한/메모를 입력한다.
- 포장/물품 관리:
  - 포장: 포장명·메모 수정 가능, 스티커 번호/등록일시는 수정 불가
  - 물품: 이름·유통기한·수량 수정, 소프트 삭제 후 라벨 재사용 가능
  - 포장 전체 삭제 가능
- 조회/검색: 최신순 목록 제공, 품목/포장명 검색, “칸 선택 + 3자리 번호 입력” 스티커 검색 지원
- 칸 선택: 사용자에게 배정된 냉장/냉동 칸만 선택 가능
- 미등록 물품 처리: 층별장이 발견한 미등록 물품은 이름만 간단 등록 후 즉시 폐기, 통계에는 “미등록 폐기”로만 집계

### 정책
- 용어:
  - 포장: 냉장고 스티커 1개에 대응하는 단위
  - 물품: 포장 내부의 개별 품목
  - 스티커 번호: 3자리 숫자, 서버에는 칸 ID와 3자리 숫자만 저장
- 호실 유형: 1인실 위치는 2F 213·224, 3F 313, 4F 413, 5F 513이며 나머지는 3인실
- 칸 할당 정책:
  - 그 층의 호실 수를 냉장/냉동 칸 기준으로 나누어 분배
  - 기본 구성은 냉장 3칸·냉동 1칸
  - 냉장 칸은 8호실 단위, 냉동 칸은 24호실 공용
- 포장 허용량: 라벨 범위(기본 001~999) 또는 관리자 설정 `max_bundle_count`로 결정
- 포장 메모는 작성자만 열람 가능
- 접근 제한: 타인 포장 수정·삭제 시 403 반환
- 검사 중인 칸/포장은 잠금 상태로 표시해 수정 불가
- 검사 이후 처리: 검사 후 수정된 물품은 별도 필터로 확인 가능

### 구현 
- 스티커 번호는 칸별 라벨 시퀀스로 3자리 자동 발급
- 라벨 재사용은 소프트 삭제를 전제로 처리

### UI 규칙 
- D-3 이하 임박은 노란 배지, 만료는 빨간 배지
- 검색/필터는 교차 적용 가능

---

## Phase 2. 로그인/회원 시스템 (Auth)

### 기능
- 회원가입: 호실 번호 + 개인 번호 조합으로 가입, 관리자 승인 전 대기 상태
- 로그인/세션: 기본 인증/세션은 서비스 내부에서 처리
- 탈퇴: 계정 비활성화 처리, 탈퇴 직후 로그인 불가, 이력은 조회 가능
- 접근 제어:
  - 거주자: 배정된 칸 및 본인 물품만 접근 가능
  - 층별장: 거주자 중에서 승격되며, 담당 층 전체 칸 검사·보고·조회 가능, 타인 포장 직접 수정 불가
  - 관리자: 전역 접근, 역할 변경 권한 보유

### 정책
- 아이디 대소문자 구분 없이 처리
- 세션은 7일 유지
- 비밀번호 변경 시 기존 세션 모두 무효화
- 데모 이후 아이디 대소문자 구분 재도입 예정
- 층 구성: 2층(남성)·3~5층(여성), 층별 24개 호실(예: 201~224, 301~324)
- 거주 기간은 최대 1년, 중도 퇴사 가능
- 개인번호는 호실 내 거주 인원 순서대로 부여(3인실은 1,2,3)
- 역할 체계: 기본 역할은 거주자이며, 층별장은 거주자에서 선발·승격된 역할

---

## Phase 3. 냉장고 검사 (Inspection)

### 기능
- 검사 세션: 담당 층 칸만 검사 시작 가능
- 검사 화면: “검사 전/검사 완료” 탭 구조
- 검사 일정: 층별장이 책임 구역 칸을 대상으로 일정 생성/수정/완료 처리, 일정 데이터는 서버에서 관리
- 조치 유형:
  - 경고: 정보와 실제 보관 불일치,  포장 상태 불량
  - 폐기: 유통기한 경과 폐기
  - 통과: `PASS`
  - 미등록 물품 발견시 즉시 등록 + 폐기
  - 기타: `reason_code` 없이 자유 메모 기록
- 검사 제출: “검사 전” 탭이 비어야 제출 가능
- 검사 이력: 층/층별장/기간 필터 제공
- 검사 이력: CSV 내보내기 옵션 고려
- 역할 전환: 층별장 임명/해제는 기존 거주자 계정 승격/복귀 방식

### 정책
- 세션 생성 시 해당 칸을 잠금 상태로 전환
- 활동 발생 시 `lockedUntil`을 현재 시각 기준 30분 뒤로 갱신
- 추가 활동 없으면 30분 후 자동 잠금 해제
- 관리자는 강제 종료로 즉시 잠금 해제 가능
- 층별장은 타인 포장 직접 수정 불가

### 구현 
- 클라이언트는 30~60초 간격 폴링으로 상태 재조회
- Draft는 `localStorage`에 보관, 세션 종료 시 자동 정리
- (확장) 다중 층별장 합류, SSE 기반 실시간 동기화
- SSE 연결 끊김 시 자동 재연결, 재연결 시 최신 세션 상태 재전송
- 재연결 실패 지속 시 단독 모드로 전환해 세션 제출

### UI 규칙
- 라벨 검색과 상태 필터링 우선 제공 (정렬 강제하지 않음)

---

## Phase 4. 관리자 기능 (Admin)

### 기능
- 현황 대시보드: 등록 물품/임박/검사 통계/활성 사용자/알림 발송 현황 제공
- 역할 관리: 층별장 임명/해제 즉시 반영
- 물품 관리: 전체 물품 조회(층/칸/호실/상태/검색/페이지네이션), 강제 수정·삭제(사유 입력 후 알림), 일괄 처리 기능을 제공한다.
- 검사 이력: 층·층별장·기간 필터, 상세 조회
- 권한 불일치 감시: `vw_fridge_bundle_owner_mismatch` 기반 이슈 조회
- 사용자 관리: 목록/역할 변경/계정 비활성화
- 자원·알림 설정:
  - 알림 배치 시각 설정 및 테스트 발송
  - `notification_policy` 기반 정책 관리
  - 냉장고 관제실(유닛/칸 상태 전환, 라벨 범위/호실 재배분, 냉장고 추가/삭제)
- 시스템 모니터링: CPU/메모리/디스크, API 응답 시간, 최근 에러 로그 조회
- 벌점 제재 통보: 기준 초과 사용자에게 알림 통보

### 정책
- 운영 프로세스: 층별장이 현장 업무, 관리자는 정책·현황 관리 중심

### UI 규칙 
- 검색 키워드: 포장명/라벨/다자릿 슬롯 코드/보관자 이름/`floor + room` 조합 지원

---

## Phase 5. 알림 유틸리티 (Notification)

### 기능
- 검사 결과 알림: 검사 제출 시 경고/폐기 대상 사용자에게 발송
- 임박/만료 알림: 매일 09:00 배치로 생성, 하루 1회 전달
- 알림 설정: 종류별 ON/OFF, 백그라운드 수신 여부 토글
- 알림 상세 연계: `correlationId`, `actionIds`, `penaltyHistoryIds` 등 이벤트 식별자 포함

### 정책
- 알림 목록은 미읽음 상단 배치, 읽음 하단 배치
- 관련 화면 진입 시 자동 읽음 처리, 24시간 후 만료·자동 제거 가능
- 모듈별 하루 최대 발송 건수 2건 제한
- Band 공지와 중복되지 않도록 dedupe 키 적용
- 오류 응답은 `ProblemDetail` 형태로 통일
- 신규 오류 코드 추가 시 OpenAPI 및 문서 동기화
- 모듈별 알림 정책:
  - 세탁실: 종료 5분 전, 상태 변경(관리/고장 신고), 남은 시간 정정, 메시지 도착
  - 냉장고: 유통기한 임박·만료(09:00 묶음), 검사 결과(경고/폐기/벌점), 검사 일정 변경
  - 도서관: 반납 5일 전/당일, 연체, 예약 대출 가능, 예약 만료 자동 취소(벌점 없음)
  - 다목적실: 시작/종료 10분 전, 노쇼 신고
  - 시스템/관리: 상·벌점 변동, 계정 승인 등 최소 공지

### 구현 
- 임박/만료 알림 배치 스케줄(09:00)
- dedupe/TTL 규칙 테이블 운용

### UI 규칙 
- 탭 배지 규칙(최대 9+, 점 표시 허용)
- 모듈별 탭 배지 유지/소거 규칙
- 탭 배지 규칙 상세:
  - 값: 미읽음 수(최대 9+), 점 표시 허용
  - 규칙: 관련 화면 진입 시 소거, 24시간 경과 시 자동 만료 가능
  - 냉장고 탭: 임박 묶음은 매일 09:00 1회 생성 후 확인 시 소거, 폐기 알림은 해결 전까지 유지
  - 도서관 탭: 임박·당일·예약 가능 묶음은 09:00 생성 후 확인 시 소거, 연체는 해결 전까지 유지
  - 메인 화면: 당일 예약된 다목적실(가장 빠른 시작 시간)과 사용 중 또는 알림 신청된 세탁실 기기 정보를 카드·팝업으로 제공
- PWA 푸시 템플릿:
  - `[세탁실] {기기명} 종료 5분 전` / 곧 사용이 끝납니다. 수거를 준비해주세요.
  - `[세탁실] {기기명} 사용 종료` / 기기 사용이 종료됐습니다. 세탁물을 회수해주세요.
  - `[세탁실] {기기명} 메시지` / {보낸이}님의 요청을 확인해주세요.
  - `[세탁실] {기기명} 상태 변경` / 기기 상태가 {상태}로 전환되었습니다. 상세를 확인해주세요.
  - `[세탁실] {기기명} 종료 시간 조정` / 종료 예정 시간이 {종료시간}로 변경되었습니다.
  - `[다목적실] {방번호} 시작 10분 전` / {시작시각} 예약이 곧 시작됩니다. 준비해주세요.
  - `[다목적실] {방번호} 종료 10분 전` / 정리 후 퇴실을 준비해주세요.
  - `[다목적실] {방번호} 예약 취소` / 관리자에 의해 예약이 취소되었습니다.
  - `[다목적실] {방번호} 노쇼 신고` / 입력된 예약이 사용되지 않았다는 신고가 접수되었습니다.
  - `[도서관] 반납 5일 전` / {권수}권 반납 또는 연장을 진행해주세요.
  - `[도서관] 반납 당일` / {권수}권 반납이 오늘 마감됩니다.
  - `[도서관] 연체 발생` / 대출 도서가 연체되었습니다. 즉시 반납해주세요.
  - `[도서관] 예약 도서 이용 가능` / {권수}권을 5일 동안 대출할 수 있습니다.
  - `[도서관] 예약 기한 오늘까지` / {권수}권 예약 대출이 오늘까지 가능합니다.
  - `[도서관] 예약 자동 취소` / 대출 기한이 만료되어 예약이 자동 취소되었습니다.
  - `[냉장고] 점검 결과 알림` / 경고 {개수}건, 폐기 {개수}건이 발생했습니다. 확인해주세요.
  - `[냉장고] 유통기한 임박` / {개수}개 품목의 유통기한이 임박했습니다.
  - `[냉장고] 유통기한 경과` / {개수}개 품목의 유통기한이 지났습니다. 폐기해주세요.
  - `[시스템] 상·벌점 변동` / {사유}로 {변동점수}점이 반영되었습니다. 현재 {총점}점입니다.
- 종 모양 알림 문구 예시:
  - `관리자로부터 상점 3점을 받았습니다.` / `'세탁물 방치' 사유로 벌점 1점을 받았습니다.`
  - `최고 관리자가 회원님의 관리자 계정을 승인했습니다.`
  - `'세탁기 1'의 작동이 5분 뒤 완료됩니다.`
  - `다른 사용자가 '건조기 2'의 남은 시간을 수정했습니다.`
  - `다른 사용자에게 '세탁기 1'번에서 '기다리고 있어요' 요청이 도착했습니다.`
  - `사용 중인 '건조기 1'의 상태가 '고장 신고'로 변경되었습니다.`
  - `'계란' 외 3개 물품의 유통기한이 5일 남았습니다.`
  - `점검 결과, 회원님의 물품 1개가 '폐기' 처리되었습니다.`
  - `'JPA 프로그래밍' 외 1권의 반납일이 5일 남았습니다.`
  - `대출하신 '데이터베이스' 도서가 연체되었습니다.`
  - `예약하신 '토비의 스프링' 도서 대출이 가능합니다.`
  - `예약하신 '토비의 스프링' 도서가 대출 기한 만료로 자동 취소되었습니다.`
  - `예약하신 '다목적실 A'의 사용 시작 10분 전입니다.`
  - `사용 중인 '다목적실 A'의 종료 10분 전입니다.`
  - `예약 도서의 대출 기한이 만료되어 자동 취소되었습니다.` (벌점 없음 안내)
- 알림 선호 기본값:
  - `FRIDGE_RESULT`: 기본 Enabled ON, 백그라운드 ON
  - `FRIDGE_EXPIRY`: 기본 Enabled ON, 백그라운드 OFF
  - `FRIDGE_EXPIRED`: 기본 Enabled ON, 백그라운드 ON

---

## Phase 6+. 확장 모듈 (차기)

### 기능
- 세탁실:  기기 예약·사용·종료 알림, 타인 기기 사용 중 행동(메시지, 남은 시간 수정), 미수거 처리, 고장 신고.
  - 종료 5분 전 알림, 남은 시간 정정(±10분), 미등록 사용자의 간편 등록, 관리자 고장 처리 및 사용 통계 관리.
- 도서관: 검색/대출/반납/예약/연장/연체 관리
  - 반납 5일 전/당일 알림, 연체 시 매일 알림, 예약 가능/만료 알림, 예약 만료에도 벌점은 부과하지 않는다.
- 다목적실: 10분 단위 예약, 합석 옵션, 노쇼 처리
  - **정책**: 예약 시작/종료 10분 전 알림, 노쇼 신고 시 관리자 확인 후 벌점, 강제 예약/취소 권한.


### 정책
- 알림 제한, 상벌점/감사 로그는 공통 적용
- 벌점 누적 10점 이상 시 시설 이용 제한(냉장고 제외)

